<%- include('partials/header') %>

<!-- Dashboard Stats -->
<div class="dashboard-stats">
    <div class="card">
        <div class="card-body text-center">
            <h3><%= stats.totalClients %></h3>
            <p class="text-muted">Active Clients</p>
        </div>
    </div>
    
    <div class="card">
        <div class="card-body text-center">
            <h3><%= stats.totalProposals %></h3>
            <p class="text-muted">Total Proposals</p>
        </div>
    </div>
    
    <div class="card">
        <div class="card-body text-center">
            <h3><%= stats.totalInvoices %></h3>
            <p class="text-muted">Total Invoices</p>
        </div>
    </div>
    
    <div class="card">
        <div class="card-body text-center">
            <h3 class="<%= stats.pendingInvoices > 0 ? 'text-warning' : 'text-success' %>"><%= stats.pendingInvoices %></h3>
            <p class="text-muted">Pending Invoices</p>
        </div>
    </div>
</div>

<!-- Overdue Invoices Alert -->
<% if (overdueInvoices && overdueInvoices.length > 0) { %>
<div class="card mb-4">
    <div class="card-header" style="background-color: var(--danger-color); color: white;">
        <h4 style="margin: 0; color: white;">⚠️ Overdue Invoices (<%= overdueInvoices.length %>)</h4>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Invoice #</th>
                        <th>Client</th>
                        <th>Amount</th>
                        <th>Due Date</th>
                        <th>Days Overdue</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% overdueInvoices.forEach(invoice => { 
                        const dueDate = new Date(invoice.due_date);
                        const today = new Date();
                        const daysOverdue = Math.floor((today - dueDate) / (1000 * 60 * 60 * 24));
                    %>
                    <tr>
                        <td><a href="/invoices/<%= invoice.id %>" class="text-primary"><%= invoice.invoice_number %></a></td>
                        <td><%= invoice.client_name %></td>
                        <td>$<%= invoice.total_amount.toFixed(2) %></td>
                        <td><%= new Date(invoice.due_date).toLocaleDateString() %></td>
                        <td class="text-danger"><%= daysOverdue %> days</td>
                        <td>
                            <a href="/invoices/<%= invoice.id %>" class="btn btn-sm btn-primary">View</a>
                        </td>
                    </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
    </div>
</div>
<% } %>

<div class="grid-3">
    <!-- Recent Clients -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h4>Recent Clients</h4>
            <a href="/clients/new" class="btn btn-sm btn-primary">Add Client</a>
        </div>
        <div class="card-body">
            <% if (recentClients && recentClients.length > 0) { %>
                <% recentClients.forEach(client => { %>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h6><a href="/clients/<%= client.id %>" class="text-primary"><%= client.name %></a></h6>
                        <p class="text-muted mb-1"><%= client.company || 'No company' %></p>
                        <small class="text-muted"><%= new Date(client.created_at).toLocaleDateString() %></small>
                    </div>
                </div>
                <% }); %>
                <div class="text-center mt-3">
                    <a href="/clients" class="btn btn-sm btn-secondary">View All Clients</a>
                </div>
            <% } else { %>
                <p class="text-muted text-center">No clients yet</p>
                <div class="text-center">
                    <a href="/clients/new" class="btn btn-primary">Add Your First Client</a>
                </div>
            <% } %>
        </div>
    </div>

    <!-- Recent Proposals -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h4>Recent Proposals</h4>
            <a href="/proposals/new" class="btn btn-sm btn-primary">New Proposal</a>
        </div>
        <div class="card-body">
            <% if (recentProposals && recentProposals.length > 0) { %>
                <% recentProposals.forEach(proposal => { %>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h6><a href="/proposals/<%= proposal.id %>" class="text-primary"><%= proposal.title %></a></h6>
                        <p class="text-muted mb-1"><%= proposal.client_name %></p>
                        <small class="text-muted">$<%= proposal.amount ? proposal.amount.toFixed(2) : '0.00' %></small>
                    </div>
                    <span class="status-badge status-<%= proposal.status %>"><%= proposal.status %></span>
                </div>
                <% }); %>
                <div class="text-center mt-3">
                    <a href="/proposals" class="btn btn-sm btn-secondary">View All Proposals</a>
                </div>
            <% } else { %>
                <p class="text-muted text-center">No proposals yet</p>
                <div class="text-center">
                    <a href="/proposals/new" class="btn btn-primary">Create First Proposal</a>
                </div>
            <% } %>
        </div>
    </div>

    <!-- Recent Invoices -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h4>Recent Invoices</h4>
            <a href="/invoices/new" class="btn btn-sm btn-primary">New Invoice</a>
        </div>
        <div class="card-body">
            <% if (recentInvoices && recentInvoices.length > 0) { %>
                <% recentInvoices.forEach(invoice => { %>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h6><a href="/invoices/<%= invoice.id %>" class="text-primary"><%= invoice.invoice_number %></a></h6>
                        <p class="text-muted mb-1"><%= invoice.client_name %></p>
                        <small class="text-muted">$<%= invoice.total_amount ? invoice.total_amount.toFixed(2) : '0.00' %></small>
                    </div>
                    <span class="status-badge status-<%= invoice.status %>"><%= invoice.status %></span>
                </div>
                <% }); %>
                <div class="text-center mt-3">
                    <a href="/invoices" class="btn btn-sm btn-secondary">View All Invoices</a>
                </div>
            <% } else { %>
                <p class="text-muted text-center">No invoices yet</p>
                <div class="text-center">
                    <a href="/invoices/new" class="btn btn-primary">Create First Invoice</a>
                </div>
            <% } %>
        </div>
    </div>
</div>

<%- include('partials/footer') %>